var magicStix={};(function(a){a.state=[],a.variableStack={},a.history=function(){a.state.push(document.body.innerHTML),window.history.pushState({},"","")},a.remote_fetch=async function(b){const c=await fetch(b,{method:"GET",headers:this.config.headers,redirect:"follow",referrerPolicy:"origin"});if(c.ok){switch(c.headers.get("Content-Type")){case"text/html":var d=await c.text();break;case"application/json":d=await c.json();break;case"multipart/form-data":d=await c.formData();break;default:d=await c.blob()}return d}},a.extend=function(e,f){a[e]=f}})(window.magicStix=window.magicStix||{}),magicStix.extend("config",{api_prefix:"http://localhost:8000/",headers:{}}),magicStix.extend("template",async function(g){var h;g.hasAttribute("content")?h=g.getAttribute("content"):g.hasAttribute("remote")?h=await magicStix.remote_fetch(g.getAttribute("remote")):g.hasAttribute("href")&&(h=await magicStix.remote_fetch(g.getAttribute("href")));var i=g.getAttribute("vars")||{},j={};try{j=JSON.parse(i)}catch{j=await magicStix.remote_fetch(i)}g.hasAttribute("norender")?g.dest.innerHTML=h:(Object.assign(magicStix.variableStack,j),console.log(magicStix.variableStack),g.dest.innerHTML=ejs.render(h,j)),magicStix.parse(g.dest)}),magicStix.extend("parse",async function(k){k.querySelectorAll("[remote]").forEach(function(l){l.dest=document.getElementById(l.getAttribute("dest-id"))||l,magicStix.template(l)}),document.querySelectorAll("[local]").forEach(function(m){null!=m.getAttribute("href")&&(m.dest=document.getElementById(m.getAttribute("dest-id"))||document.body,m.onclick=function(n){n.preventDefault(),magicStix.history(),magicStix.template(m)})})}),window.onload=function(){let o=document.createElement("script");o.setAttribute("src","https://cdn.jsdelivr.net/npm/ejs@3.1.6/ejs.min.js"),document.body.prepend(o),o.onload=function(){window.addEventListener("popstate",p=>{document.body.innerHTML=magicStix.state.pop(),magicStix.parse(document.body)}),magicStix.parse(document.body)}};